<link rel="import" href="../polymer/polymer-element.html">

<dom-module id="channels-card-demo-helper">
  <template>
    <style>
      .container {
        max-width: 600px;
        margin: 0 auto;
      }

      #composerContainer {
        margin: 10px 0;
        background-color: white;
        border: 1px solid #aaa;
        padding: 4px;
      }

      #composerArea {
        position: relative;
      }

      #viewerArea {
        margin-top: 50px;
      }

      #viewerContainer {
        margin: 10px 0;
        border: 1px solid #aaa;
        background-color: white;
        padding: 4px;
      }
    </style>
    <div class="container">
      <div id="composerArea">
        <h3>Composer</h3>
        <div style="position: relative;">
          <div id="composerContainer"></div>
        </div>
      </div>
      <div id="viewerArea">
        <h3>Viewer</h3>
        <div id="viewerContainer"></div>
      </div>
    </div>
  </template>
  <script>
    class ChannelsComposerServices {
      upload(file) {
        return new Promise((resolve, reject) => {
          resolve("about:blank");
        });
      }
    }
    class ChannelsCardDemoHelper extends Polymer.Element {
      static get is() { return 'channels-card-demo-helper'; }
      static get properties() {
        return {
          composerTagName: String,
          viewerTagName: String,
        };
      }
      connectedCallback() {
        super.connectedCallback();
        this.composer = document.createElement(this.composerTagName);
        this.composer.services = new ChannelsComposerServices();
        this.composer.author = {
          handle: "jdoe",
          name: "John Doe"
        };
        this.composer.addEventListener('ready-changed', () => {
          this._initializeViewer();
        });
        this.composer.addEventListener('shared-state-changed', () => {
          this._initializeViewer();
        });
        this.$.composerContainer.appendChild(this.composer);
        this._initializeViewer();
      }
      _initializeViewer() {
        while (this.$.viewerContainer.firstChild) {
          this.$.viewerContainer.removeChild(this.$.viewerContainer.firstChild);
        }
        if (this.composer.ready) {
          this.$.viewerArea.style.display = "";
          this.viewer = document.createElement(this.viewerTagName);
          this.viewer.sharedState = JSON.parse(JSON.stringify(this.composer.getSharedState() || { properties: {}, collections: {} }));
          this.viewer.author = {
            handle: "jdoe",
            name: "John Doe"
          };
          this.viewer.author = {
            handle: "jane",
            name: "Jane Doe"
          };
          this.$.viewerContainer.appendChild(this.viewer);
        } else {
          this.$.viewerArea.style.display = "none";
        }
      }
    }
    window.customElements.define(ChannelsCardDemoHelper.is, ChannelsCardDemoHelper);
  </script>
</dom-module>